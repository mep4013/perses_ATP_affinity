#!/bin/bash

#without proline mutations HIE396PRO, ALA397PRO and PRO480LEU
# MUTATIONS=('MET244VAL' 'LEU248ARG' 'LEU248VAL' 'GLY250GLU' 'GLY250ARG' 'GLY251ASP' 'GLY251GLU' 'GLN252GLU' 'GLN252HIS' 'GLN252LYS' 'GLN252MET' 'GLN252ARG' 'TYR253PHE' 'TYR253HIS' 'GLU255LYS' 'GLU255VAL' 'VAL256LEU' 'VAL268ALA' 'LEU273MET' 'GLU275LYS' 'ASP276ALA' 'ASP276GLY' 'THR277ALA' 'GLU279LYS' 'GLU279TYR' 'GLU281LYS' 'GLU282GLY' 'GLU282LYS' 'VAL289ALA' 'VAL289PHE' 'GLU292VAL' 'LEU298PHE' 'VAL299LEU' 'PHE311LEU' 'THR315ALA' 'THR315ILE' 'THR315ASN' 'PHE317CYS' 'PHE317ILE' 'PHE317LEU' 'PHE317THR' 'PHE317VAL' 'TYR320CYS' 'LEU324GLN' 'ASP325GLY' 'ARG328MET' 'VAL338PHE' 'MET343THR' 'MET351LYS' 'MET351THR' 'GLU352ASP' 'GLU352GLY' 'TYR353HIS' 'GLU355ALA' 'GLU355GLY' 'PHE359ALA' 'PHE359CYS' 'PHE359ILE' 'PHE359VAL' 'LEU364ILE' 'ASN368SER' 'ASN374TYR' 'LYS378ARG' 'VAL379ILE' 'LEU384MET' 'LEU387PHE' 'LEU387MET' 'MET388LEU' 'HIE396ARG' 'GLY398ARG' 'ALA399THR' 'SER417TYR' 'ILE418VAL' 'LYS419GLU' 'ALA433THR' 'SER438CYS' 'ASP444TYR' 'GLU450ALA' 'GLU450GLY' 'GLU450LYS' 'GLU453ALA' 'GLU453ASP' 'GLU453GLY' 'GLU453LEU' 'GLU459GLY' 'GLU459LYS' 'GLU459GLN' 'ASP482VAL' 'PHE486SER' 'GLU494GLY' 'THR495ARG')
# PHASES=('apo' 'complex')
# LIGANDS=('imatinib' 'dasatinib')
MUTATIONS=('THR315ILE')
PHASES=('apo')
NEQ_DIRECTORY=/data1/choderaj/pathilm/FEC/abl/3_NEQ

JOB_NUMBERS=$(seq 1 200)

for MUTATION in $MUTATIONS; do
  for PHASE in $PHASES; do
    for JOB_NUMBER in $JOB_NUMBERS; do 
      directory=$NEQ_DIRECTORY/$MUTATION/$PHASE
      file_pattern=*_$JOB_NUMBER.npy
      num_files=$(find "$directory" -maxdepth 1 -name "$file_pattern" -type f 2>/dev/null | wc -l)
      if [[ "$num_files" -lt 2 ]]; then
        echo "file_count"
        sbatch \
        --time=2:00:00 \
        --export=MUTATION=$MUTATION,PHASE=$PHASE,NEQ_DIRECTORY=$NEQ_DIRECTORY,SLURM_ARRAY_TASK_ID=$JOB_NUMBER \
        --output=$directory/$PHASE-%a.log \
        --error=$directory/$PHASE-%a.stderr \
        submit_neq.sh 
        fi
    done
  done
done